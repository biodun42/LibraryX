@page
@model ChangePasswordModel
@{
    ViewData["Title"] = "Change password";
    ViewData["ActivePage"] = ManageNavPages.ChangePassword;
}

<div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between">
    <div>
        <h2 class="text-2xl font-bold text-white">Change Password</h2>
        <p class="text-primary-200 text-sm mt-1">Update your account password to enhance security</p>
    </div>
</div>

<!-- Status Message -->
<div class="mb-6">
    <partial name="_StatusMessage" for="StatusMessage" />
</div>

<!-- Password Form Card -->
<div class="bg-white/5 backdrop-blur-sm rounded-xl p-2 sm:p-4 shadow-lg border border-white/10">
    <div class="space-y-8">
        <div>
            <h3 class="text-lg font-medium text-primary-100 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary-300" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                Update Your Password
            </h3>
            <p class="mt-1 text-sm text-primary-300">Regularly changing your password helps protect your account from unauthorized access</p>
        </div>

        <form id="change-password-form" method="post" class="space-y-6">
            <div asp-validation-summary="ModelOnly" class="text-red-400 font-medium text-sm rounded-lg bg-red-900/20 p-3" role="alert"></div>
            
            <!-- Password Fields -->
            <div class="space-y-5">
                <!-- Current Password Field -->
                <div>
                    <label asp-for="Input.OldPassword" class="block text-sm font-medium text-white mb-1">Current Password</label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v-1l1-1 1-1-1-1H6v-1h2l2-2-4.257-4.257A6 6 0 1118 8zm-11.586.707a1 1 0 00-1.414 0l-.707.707.707.707a1 1 0 001.414-1.414zm8.293 8.293l-1.414 1.414L18 15.414V13h-2.586l-.707.707z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <input asp-for="Input.OldPassword" class="block w-full pl-10 pr-3 py-3 text-white bg-primary-800/50 border border-primary-700 rounded-lg focus:ring-primary-500 focus:border-primary-500 focus:outline-none placeholder-primary-400" placeholder="Enter your current password" autocomplete="current-password" aria-required="true" />
                    </div>
                    <span asp-validation-for="Input.OldPassword" class="mt-1 text-sm text-red-400 block"></span>
                </div>

                <!-- New Password Field -->
                <div>
                    <label asp-for="Input.NewPassword" class="block text-sm font-medium text-white mb-1">New Password</label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <input asp-for="Input.NewPassword" class="block w-full pl-10 pr-3 py-3 text-white bg-primary-800/50 border border-primary-700 rounded-lg focus:ring-primary-500 focus:border-primary-500 focus:outline-none placeholder-primary-400" placeholder="Create a strong new password" autocomplete="new-password" aria-required="true" />
                    </div>
                    <span asp-validation-for="Input.NewPassword" class="mt-1 text-sm text-red-400 block"></span>
                    <p class="mt-1 text-xs text-primary-400">Password must be at least 6 characters long with letters, numbers, and special characters</p>
                </div>

                <!-- Confirm Password Field -->
                <div>
                    <label asp-for="Input.ConfirmPassword" class="block text-sm font-medium text-white mb-1">Confirm New Password</label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <input asp-for="Input.ConfirmPassword" class="block w-full pl-10 pr-3 py-3 text-white bg-primary-800/50 border border-primary-700 rounded-lg focus:ring-primary-500 focus:border-primary-500 focus:outline-none placeholder-primary-400" placeholder="Re-enter your new password" autocomplete="new-password" aria-required="true" />
                    </div>
                    <span asp-validation-for="Input.ConfirmPassword" class="mt-1 text-sm text-red-400 block"></span>
                </div>
            </div>
            
            <!-- Password Strength Indicator -->
            <div class="pt-4 border-t border-white/10">
                <h4 class="text-sm font-medium text-primary-100 mb-2 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-primary-300" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                    Password Strength
                </h4>
                <div class="w-full bg-primary-800/50 rounded-full h-2.5 mb-1">
                    <div id="password-strength-bar" class="bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <p id="password-strength-text" class="text-xs text-primary-300">Enter a new password to see strength</p>
            </div>
            
            <!-- Submit Button -->
            <div class="pt-6 border-t border-white/10">
                <button type="submit" class="w-full sm:w-auto flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all shadow-md hover:shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v-1l1-1 1-1-1-1H6v-1h2l2-2-4.257-4.257A6 6 0 1118 8zm-11.586.707a1 1 0 00-1.414 0l-.707.707.707.707a1 1 0 001.414-1.414zm8.293 8.293l-1.414 1.414L18 15.414V13h-2.586l-.707.707z" clip-rule="evenodd" />
                    </svg>
                    Update Password
                </button>
            </div>
        </form>
    </div>
</div>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Simple password strength meter
        document.addEventListener('DOMContentLoaded', function() {
            const newPasswordInput = document.getElementById('Input_NewPassword');
            const strengthBar = document.getElementById('password-strength-bar');
            const strengthText = document.getElementById('password-strength-text');
            
            newPasswordInput.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;
                
                // Length check
                if (password.length > 0) strength += 10;
                if (password.length >= 8) strength += 10;
                if (password.length >= 12) strength += 10;
                
                // Complexity checks
                if (/[a-z]/.test(password)) strength += 10;
                if (/[A-Z]/.test(password)) strength += 10;
                if (/[0-9]/.test(password)) strength += 10;
                if (/[^A-Za-z0-9]/.test(password)) strength += 10;
                
                // Variety checks
                const chars = {};
                for (let i = 0; i < password.length; i++) {
                    chars[password[i]] = (chars[password[i]] || 0) + 1;
                }
                const uniqueChars = Object.keys(chars).length;
                if (uniqueChars > 4) strength += 10;
                if (uniqueChars > 8) strength += 20;
                
                // Update UI
                strengthBar.style.width = `${Math.min(strength, 100)}%`;
                
                if (strength < 30) {
                    strengthText.textContent = 'Very weak - Please use a stronger password';
                    strengthText.className = 'text-xs text-red-400';
                } else if (strength < 60) {
                    strengthText.textContent = 'Fair - Add more characters and symbols';
                    strengthText.className = 'text-xs text-yellow-400';
                } else if (strength < 80) {
                    strengthText.textContent = 'Good - Your password is acceptable';
                    strengthText.className = 'text-xs text-blue-400';
                } else {
                    strengthText.textContent = 'Great! Your password is very strong';
                    strengthText.className = 'text-xs text-green-400';
                }
                
                // No input case
                if (password.length === 0) {
                    strengthBar.style.width = '0%';
                    strengthText.textContent = 'Enter a new password to see strength';
                    strengthText.className = 'text-xs text-primary-300';
                }
            });
        });
    </script>
}
